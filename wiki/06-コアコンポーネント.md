# 🧩 6. コアコンポーネント

ACE Frameworkは、複数の自律的なコンポーネントが連携することで、高度な記憶と学習を実現しています。

## 1. Curator (意図分析と文脈検索)

ユーザーの入力をそのまま検索に使うのではなく、一度LLMで分析することで、より精度の高いコンテキスト抽出を行います。

- **役割**: ユーザーの質問から「具体的なエンティティ」と「抽象的な問題クラス」を抽出し、検索クエリを生成。
- **最適化**: 短い挨拶や単純な返答（例：「ありがとう」「はい」など）に対しては、LLMによる分析をスキップして直接ベクトル検索を行う「Fast-path」機能を搭載。
- **コンテキスト注入**: 検索された過去の知識を `SystemMessage` として対話履歴の先頭に挿入。

**実装コード参照:**
- `(../src/ace_rm/agent/graph.py:61-125)`

## 2. Agent (応答生成)

Curatorによって強化されたコンテキストを基に、ユーザーへの最終的な回答を生成します。

- **役割**: 提供された知識を活用して、正確で文脈に沿った応答を作成。
- **ツール利用**: 必要に応じて `search_memory_tool` を呼び出し、自律的に記憶を再検索することも可能。

**実装コード参照:**
- `(../src/ace_rm/agent/graph.py:127-133)`

## 3. Reflector (対話の記録)

エージェントの応答が完了した直後に実行され、学習のきっかけを作ります。

- **役割**: 現在の対話ペア（ユーザー入力 + エージェント応答）を `TaskQueue` に保存。
- **非同期性の確保**: ここでは重い学習処理は行わず、キューへの保存のみを行うため、ユーザーの待ち時間を最小限に抑えています。

**実装コード参照:**
- `(../src/ace_rm/agent/graph.py:135-155)`

## 4. Background Worker (構造的学習)

バックグラウンドスレッドで常時稼働し、キューに溜まった対話から知識を抽出・蓄積します。

- **役割**: `TaskQueue` から未処理のタスクを取得し、分析を実行。
- **統合分析 (Unified Analysis)**: LLMを使用して、対話から「再利用可能な教訓」や「解決戦略」を抽出します。
- **知識の合成 (Synthesis)**:
  - **NEW**: 全く新しい知識として保存。
  - **UPDATE**: 既存の知識をより良い内容に更新。
  - **KEPT/IGNORED**: 重複や不要な情報を排除。

**実装コード参照:**
- `(../src/ace_rm/workers/background.py:18-97)`

---
詳細は [APIとプロンプト](./07-APIとプロンプト.md) を参照してください。
