# 日本語プロンプトテンプレート

ANALYSIS_PROMPT = """
このやり取りを分析し、構造的知識（MFR）と一般的原則を抽出してください。

1. **具体的分析**: 問題が提示されている場合、以下を定義してください：
   - エンティティ、状態変数、アクション、制約。
   - 解決策の要約。

2. **抽象化と一般化**:
   - 具体的な詳細を一般的なパターンやルールに抽象化してください。
   - 根本的な問題クラス（例：「制約充足」、「リソース配分」）を特定してください。
   - この事例から導き出される一般的な戦略を定義してください。

ユーザー: {user_input}
AI: {agent_output}

Output JSON only:
{{
    "analysis": "**具体的なモデル**:\\n[詳細...]\\n\\n**一般化**:\\n[詳細...]",
    "entities": ["エンティティの", "リスト"],
    "problem_class": "特定された問題クラス",
    "should_store": true/false
}}
"""

SYNTHESIZER_PROMPT = """
あなたはAIメモリシステムの「知識合成器」です。
目的は、高品質で重複のない知識ベースを維持することです。

既存の知識と、最近のやり取りから得られた新しい知識を比較してください。

既存の知識 (ID: {best_match_id}):
{existing_content}

新しい知識:
{new_content}

最善のアクションを決定してください：
1. **UPDATE**: 新しい知識が既存の知識に価値を加え、修正、または洗練させる場合。それらを1つの包括的なエントリにマージします。
2. **KEPT**: 新しい知識が冗長であるか、劣っているか、あるいは既に既存の知識でカバーされている場合。既存の知識をそのまま保持します。
3. **NEW**: 新しい知識が別のエントリとして区別されるべき場合（例：文脈が異なる、矛盾しているが有効な代替案など）。

Output JSON only:
{{
    "action": "UPDATE" | "KEPT" | "NEW",
    "rationale": "決定の簡単な理由",
    "synthesized_content": "マージされたコンテンツ (UPDATEの場合のみ、それ以外はnull)",
    "merged_entities": ["すべてのエンティティの", "リスト"] (UPDATEの場合のみ)
}}
"""

INTENT_ANALYSIS_PROMPT = """
会話の履歴に基づいて、ユーザーの最新の要求を分析してください。

次の2つの事項を対象としてください：
1. 要求に含まれる具体的なエンティティと事実。
2. 要求に関連する抽象的な問題クラス、構造的パターン、または一般的原則。

ユーザーの要求: "{user_input}"
履歴: 
{history_txt}

Output JSON only:
{{
    "entities": ["エンティティ1", "エンティティ2"],
    "problem_class": "抽象的な問題クラス",
    "search_query": "具体的なエンティティと抽象的な概念を組み合わせた、単一の効果的な検索クエリ文字列"
}}
"""

RETRIEVED_CONTEXT_TEMPLATE = "--- 取得されたコンテキスト ---\n{context_str}\n-----------------------"
